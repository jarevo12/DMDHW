<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axiom Forge | Onboarding Evidence Flow V2</title>
    <style>
        /* ========================================
           CORE STYLES
           ======================================== */
        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-tertiary: #111111;
            --text-primary: #ffffff;
            --text-secondary: #999999;
            --accent-green: #ccff00;
            --accent-purple: #a78bfa;
            --border-color: #333;
            --font-mono: 'Courier New', monospace;
            --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg-primary); color: var(--text-primary); font-family: var(--font-sans); padding: 20px; }
        
        .container { max-width: 450px; margin: 0 auto; border: 1px solid var(--border-color); min-height: 800px; position: relative; overflow: hidden; background: var(--bg-secondary); }
        
        /* ========================================
           CONTROLS (For Preview Only)
           ======================================== */
        .controls {
            position: fixed; top: 20px; right: 20px; width: 250px;
            background: #1a1a1a; padding: 15px; border: 1px solid var(--accent-green);
            z-index: 1000;
        }
        .controls h3 { margin-bottom: 10px; font-size: 0.9rem; color: var(--accent-green); }
        .controls button {
            display: block; width: 100%; padding: 8px; margin-bottom: 5px;
            background: #333; color: #fff; border: 1px solid #444; cursor: pointer;
            text-align: left; font-family: var(--font-mono); font-size: 0.8rem;
        }
        .controls button.active { background: var(--accent-green); color: black; font-weight: bold; }
        .controls button:hover { opacity: 0.9; }

        /* ========================================
           STEP 1: GOAL SELECTION
           ======================================== */
        .step-view { display: none; padding: 30px 20px; height: 100%; flex-direction: column; }
        .step-view.active { display: flex; }

        .logo-area { text-align: center; margin-bottom: 30px; }
        .logo-area img { height: 40px; }

        h1 { font-size: 2rem; margin-bottom: 10px; line-height: 1.1; }
        .subtitle { color: var(--text-secondary); margin-bottom: 40px; font-size: 1rem; line-height: 1.5; }

        .select-group { margin-bottom: 30px; }
        .select-group label { display: block; font-family: var(--font-mono); font-size: 0.8rem; color: var(--accent-green); margin-bottom: 10px; }
        
        .custom-select {
            width: 100%; padding: 15px; background: var(--bg-primary); border: 2px solid var(--text-primary);
            color: var(--text-primary); font-size: 1.1rem; cursor: pointer;
        }

        /* Summary Box on Step 1 */
        .summary-card {
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--accent-green);
            padding: 20px;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }
        .summary-title { font-family: var(--font-mono); font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; }
        .summary-text { font-size: 1rem; line-height: 1.4; }

        /* ========================================
           STEP 2: ROUTINE PREVIEW
           ======================================== */
        .step-header { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .step-back { background: none; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1.2rem; }
        
        .routine-section { margin-bottom: 30px; }
        .section-title { 
            font-family: var(--font-mono); font-size: 0.9rem; color: var(--accent-green); 
            margin-bottom: 15px; display: flex; align-items: center; gap: 8px; 
        }

        /* DEFAULT LIST STYLE */
        .step-list { list-style: none; }
        .step-item { 
            background: var(--bg-primary); border: 1px solid var(--border-color); 
            margin-bottom: 10px; padding: 15px; position: relative;
        }

        .step-content { display: flex; justify-content: space-between; align-items: center; }
        .step-text { font-size: 0.95rem; line-height: 1.4; flex: 1; padding-right: 10px; }

        /* ========================================
           OPTION A: ACCORDION
           ======================================== */
        .option-a .evidence-btn {
            background: transparent; border: 1px solid var(--text-secondary); color: var(--text-secondary);
            font-size: 0.7rem; padding: 4px 8px; border-radius: 4px; cursor: pointer; white-space: nowrap;
        }
        .option-a .evidence-btn:hover { border-color: var(--accent-green); color: var(--accent-green); }
        
        .evidence-card {
            display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #333;
            font-size: 0.85rem; color: var(--text-secondary);
        }
        .evidence-card.open { display: block; animation: slideDown 0.3s ease; }
        
        .source-label { display: block; color: var(--accent-purple); font-weight: bold; margin-bottom: 4px; font-size: 0.8rem; }
        .source-link { 
            display: inline-block; margin-top: 8px; color: var(--text-primary); 
            text-decoration: underline; font-size: 0.8rem; cursor: pointer; 
        }

        /* ========================================
           OPTION B: SCIENCE MODE TOGGLE
           ======================================== */
        .science-toggle-wrapper {
            display: flex; align-items: center; gap: 10px; margin-bottom: 20px; 
            padding: 10px; background: var(--bg-tertiary); border: 1px solid var(--border-color);
        }
        .toggle-switch {
            position: relative; width: 40px; height: 20px; background: #333; border-radius: 10px; cursor: pointer;
        }
        .toggle-switch::after {
            content: ''; position: absolute; left: 2px; top: 2px; width: 16px; height: 16px;
            background: #fff; border-radius: 50%; transition: 0.3s;
        }
        .toggle-switch.active { background: var(--accent-green); }
        .toggle-switch.active::after { left: 22px; background: #000; }
        
        .option-b .step-item { transition: all 0.3s; }
        .option-b.science-active .step-item { border-left: 3px solid var(--accent-green); }
        .option-b.science-active .evidence-card { display: block; }
        
        /* ========================================
           OPTION C: SOURCE PILLS (MODAL)
           ======================================== */
        .option-c .source-pill {
            display: inline-flex; align-items: center; gap: 5px;
            background: #222; border: 1px solid #444; color: var(--text-secondary);
            font-size: 0.7rem; padding: 4px 8px; border-radius: 12px; cursor: pointer; margin-top: 8px;
        }
        .option-c .source-pill:hover { border-color: var(--accent-green); color: var(--accent-green); }
        .option-c .pill-icon { width: 6px; height: 6px; background: var(--accent-green); border-radius: 50%; }

        /* MODAL */
        .evidence-modal {
            display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9); z-index: 2000; backdrop-filter: blur(5px);
            justify-content: center; align-items: flex-end; /* Bottom sheet style */
        }
        .evidence-modal.open { display: flex; }
        
        .modal-sheet {
            background: #1a1a1a; width: 100%; max-width: 450px; 
            border-top: 2px solid var(--accent-green); padding: 30px;
            border-radius: 20px 20px 0 0; animation: slideUp 0.3s ease;
        }
        
        .modal-title { font-size: 1.2rem; margin-bottom: 20px; color: var(--text-primary); }
        .modal-source-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #333; }
        .modal-close { 
            background: #333; width: 100%; padding: 15px; border: none; color: white; 
            font-weight: bold; cursor: pointer; margin-top: 10px; 
        }

        /* ========================================
           UTILITIES
           ======================================== */
        .btn-continue {
            width: 100%; padding: 18px; background: var(--text-primary); color: var(--bg-primary);
            border: none; font-weight: bold; font-size: 1.1rem; cursor: pointer; margin-top: auto;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-continue:hover { background: var(--accent-green); }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

    </style>
</head>
<body>

    <!-- PREVIEW CONTROLS (Floating) -->
    <div class="controls">
        <h3>STEP 2 VISUAL OPTIONS</h3>
        <button onclick="setOption('a')" id="btn-opt-a" class="active">Option A: Inline Button</button>
        <button onclick="setOption('b')" id="btn-opt-b">Option B: "Science Mode"</button>
        <button onclick="setOption('c')" id="btn-opt-c">Option C: Pills + Modal</button>
        <div style="margin-top: 15px; font-size: 0.7rem; color: #666;">
            Goal: "Get Fitter" selected for demo.
        </div>
    </div>

    <div class="container">
        <!-- STEP 1: GOAL SELECTION -->
        <div id="step-1" class="step-view active">
            <div class="logo-area"><img src="../assets/logo-white-back.svg" alt="Axiom"></div>
            <h1>Your <span style="color:var(--accent-green)">Goal</span></h1>
            <p class="subtitle">We'll build a routine to help you get there.</p>

            <div class="select-group">
                <label>I WANT TO...</label>
                <select class="custom-select" id="goal-select" onchange="updateSummary()">
                    <option value="get_fitter">Get fitter</option>
                    <option value="sleep_better">Sleep better</option>
                    <option value="productivity">Be more productive</option>
                </select>
            </div>

            <!-- DYNAMIC SUMMARY (Clean) -->
            <div class="summary-card" id="step1-summary">
                <!-- Injected via JS -->
            </div>

            <button class="btn-continue" onclick="goToStep(2)">Continue</button>
        </div>

        <!-- STEP 2: ROUTINE PREVIEW -->
        <div id="step-2" class="step-view">
            <div class="step-header">
                <button class="step-back" onclick="goToStep(1)">&larr;</button>
                <span style="font-family:var(--font-mono); font-size:0.8rem; color:var(--text-secondary)">PREVIEW ROUTINE</span>
            </div>

            <h1 id="routine-title" style="font-size: 1.8rem; margin-bottom: 20px;">Get Fitter</h1>

            <!-- Option B Toggle (Hidden unless Option B active) -->
            <div id="science-toggle" class="science-toggle-wrapper" style="display:none;">
                <div class="toggle-switch" onclick="toggleScienceMode(this)"></div>
                <span style="font-size:0.9rem; font-weight:bold;">Explain the Science</span>
            </div>

            <div style="flex:1; overflow-y: auto; padding-bottom: 20px;">
                <!-- MORNING -->
                <div class="routine-section">
                    <div class="section-title"><span>&#9788;</span> MORNING</div>
                    <ul class="step-list" id="morning-list">
                        <!-- Injected via JS -->
                    </ul>
                </div>

                <!-- EVENING -->
                <div class="routine-section">
                    <div class="section-title"><span>&#9790;</span> EVENING</div>
                    <ul class="step-list" id="evening-list">
                        <!-- Injected via JS -->
                    </ul>
                </div>
            </div>

            <button class="btn-continue">Start Journey</button>
        </div>
    </div>

    <!-- MODAL (For Option C) -->
    <div id="evidence-modal" class="evidence-modal" onclick="closeModal(event)">
        <div class="modal-sheet">
            <div class="modal-title">Scientific Basis</div>
            <div id="modal-content"></div>
            <button class="modal-close" onclick="closeModal(event)">Close</button>
        </div>
    </div>

    <script>
        // ========================================
        // DATA
        // ========================================
        const ROUTINES = {
            'get_fitter': {
                label: "Get Fitter",
                summary: "Protocols derived from ACSM guidelines for mobility and progressive resistance, optimized for adherence.",
                morning: [
                    { 
                        text: "5-10 min light mobility", 
                        source: "American College of Sports Medicine", 
                        claim: "Primes joints and reduces injury risk by increasing blood flow.",
                        links: [{text: "Read Position Stand", url: "#"}]
                    },
                    { 
                        text: "30g Protein Breakfast", 
                        source: "Journal of Physiology", 
                        claim: "Optimizes muscle protein synthesis compared to lower doses.",
                        links: [{text: "Read Study", url: "#"}]
                    },
                    { 
                        text: "10-20 min brisk walk", 
                        source: "CDC Physical Activity Guidelines", 
                        claim: "Contributes to the recommended 150 min/week moderate activity.",
                        links: [{text: "CDC Guidelines", url: "#"}]
                    }
                ],
                evening: [
                    { 
                        text: "Pre-sleep protein (20-40g)", 
                        source: "Medicine & Science in Sports & Exercise", 
                        claim: "Significantly increases overnight muscle protein synthesis.",
                        links: [{text: "View Research", url: "#"}]
                    }
                ]
            },
            'sleep_better': {
                label: "Sleep Better",
                summary: "Circadian entrainment protocols based on AASM guidelines, focusing on light exposure and thermoregulation.",
                morning: [
                    { 
                        text: "Bright light (10-20 mins)", 
                        source: "American Academy of Sleep Medicine", 
                        claim: "Primary treatment for circadian alignment; anchors sleep/wake cycle.",
                        links: [{text: "AASM Guide", url: "#"}]
                    }
                ],
                evening: [
                    { 
                        text: "Warm bath/shower (90 min before bed)", 
                        source: "Sleep Medicine Reviews", 
                        claim: "Passive heating reduces sleep onset latency via cooling effect.",
                        links: [{text: "Meta-Analysis", url: "#"}]
                    }
                ]
            }
        };

        // ========================================
        // APP LOGIC
        // ========================================
        let currentOption = 'a';
        let currentRoutineKey = 'get_fitter';

        function init() {
            updateSummary();
            renderRoutine();
        }

        function setOption(opt) {
            currentOption = opt;
            
            // Update UI Controls
            document.querySelectorAll('.controls button').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-opt-${opt}`).classList.add('active');

            // Reset specific states
            document.getElementById('science-toggle').style.display = (opt === 'b') ? 'flex' : 'none';
            document.getElementById('step-2').className = `step-view active option-${opt}`;
            
            // Re-render
            renderRoutine();
        }

        function goToStep(step) {
            document.querySelectorAll('.step-view').forEach(el => el.classList.remove('active'));
            document.getElementById(`step-${step}`).classList.add('active');
            
            // Re-apply option class to step 2 if entering it
            if(step === 2) {
                document.getElementById('step-2').className = `step-view active option-${currentOption}`;
            }
        }

        function updateSummary() {
            const val = document.getElementById('goal-select').value;
            currentRoutineKey = val;
            const r = ROUTINES[val] || ROUTINES['get_fitter']; // Fallback
            
            document.getElementById('step1-summary').innerHTML = `
                <div class="summary-title">SCIENTIFIC BASIS</div>
                <div class="summary-text">${r.summary}</div>
            `;
        }

        function renderRoutine() {
            const r = ROUTINES[currentRoutineKey] || ROUTINES['get_fitter'];
            document.getElementById('routine-title').innerText = r.label;

            renderList('morning-list', r.morning);
            renderList('evening-list', r.evening);
        }

        function renderList(elementId, items) {
            const container = document.getElementById(elementId);
            container.innerHTML = items.map((item, idx) => {
                const uniqueId = `${elementId}-${idx}`;
                
                // --- OPTION A: Inline Button ---
                if (currentOption === 'a') {
                    return `
                        <li class="step-item">
                            <div class="step-content">
                                <span class="step-text">${item.text}</span>
                                <button class="evidence-btn" onclick="toggleCard('${uniqueId}')">Why? &darr;</button>
                            </div>
                            <div id="${uniqueId}" class="evidence-card">
                                <span class="source-label">${item.source}</span>
                                <p>${item.claim}</p>
                                ${renderLinks(item.links)}
                            </div>
                        </li>
                    `;
                }
                
                // --- OPTION B: Science Mode (Hidden card by default) ---
                else if (currentOption === 'b') {
                    return `
                        <li class="step-item">
                            <div class="step-content">
                                <span class="step-text">${item.text}</span>
                            </div>
                            <div class="evidence-card">
                                <span class="source-label">${item.source}</span>
                                <p>${item.claim}</p>
                                ${renderLinks(item.links)}
                            </div>
                        </li>
                    `;
                }

                // --- OPTION C: Pill + Modal ---
                else if (currentOption === 'c') {
                    // We attach data to the pill for the modal to read
                    const dataStr = encodeURIComponent(JSON.stringify(item));
                    return `
                        <li class="step-item">
                            <div class="step-content" style="display:block">
                                <div class="step-text">${item.text}</div>
                                <div class="source-pill" onclick="openEvidenceModal('${dataStr}')">
                                    <div class="pill-icon"></div>
                                    Source: ${item.source}
                                </div>
                            </div>
                        </li>
                    `;
                }
            }).join('');
        }

        function renderLinks(links) {
            return links.map(l => `<a class="source-link" href="${l.url}">${l.text} &rarr;</a>`).join(' ');
        }

        // --- INTERACTIONS ---

        function toggleCard(id) {
            const card = document.getElementById(id);
            const isOpen = card.classList.contains('open');
            // Optional: Close others? Nah, let them keep multiple open
            if(isOpen) {
                card.classList.remove('open');
            } else {
                card.classList.add('open');
            }
        }

        function toggleScienceMode(btn) {
            btn.classList.toggle('active');
            document.getElementById('step-2').classList.toggle('science-active');
        }

        function openEvidenceModal(dataStr) {
            const item = JSON.parse(decodeURIComponent(dataStr));
            const content = document.getElementById('modal-content');
            
            content.innerHTML = `
                <div style="margin-bottom:15px; color:var(--accent-purple); font-weight:bold; font-family:var(--font-mono)">${item.source}</div>
                <p style="font-size:1rem; line-height:1.5; margin-bottom:20px;">${item.claim}</p>
                <div>${renderLinks(item.links)}</div>
            `;
            
            document.getElementById('evidence-modal').classList.add('open');
        }

        function closeModal(e) {
            if (e.target.id === 'evidence-modal' || e.target.classList.contains('modal-close')) {
                document.getElementById('evidence-modal').classList.remove('open');
            }
        }

        // Start
        init();

    </script>
</body>
</html>
